{{ $html_table := .html_table }}
{{ $class := .class }}
{{ $scrollable := .scrollable }}  {{/* https://stackoverflow.com/questions/8232713/how-to-display-scroll-bar-onto-a-html-table */}}

{{ $old := "<table>" }}
{{ $new := printf "<table class=\"%s\">" $class }}
{{ $html_table = replace $html_table $old $new }}
{{ $html_table = replace $html_table "\\n" "<br>" }}  {{/* åœ¨è£é ­å¯ä»¥ä½¿ç”¨\nä¾†æ›è¡Œï¼Œæ¨¡æ“¬list */}}

{{/* ä½¿çš„æ¬„å¯¬å¯ä»¥ç”¨æ›´ç°¡å–®çš„æ–¹å¼ä¾†è¨­å®š
  | @@w=5em@@name | desc |
  | ---- | ---- |

  ä¹Ÿèƒ½å’Œtext-align(:----:, :----, ----:)äº’ç›¸æ­é…
    p.s. ä½†ç›®å‰é‚„æ˜¯æœ‰bugå­˜åœ¨ï¼Œæ‰€ä»¥å¦‚æœæ‚¨éè¦ç”¨text-alignå‰‡å¯¬åº¦å°±å¿…é ˆè¦å…¨éƒ¨è¨­å®šä¸Šå»ï¼Œæ‰ä¸æœƒæœ‰bugå‡ºç¾ï¼Œå¦‚ä¸‹:
  | @@w=10%@@name | @@w=30%@@Desc | @@w=10%@@Code |  ã€€ |
  | :----: | :---- | :----: | ---- |
  | ğŸ“ | Memo | 1F4DD
*/}}
{{ $th_list := findRE "<th.*>.*</th>" $html_table }}
{{ range $th_list }}
  {{ $org_style := default "" (replaceRE `<th (?P<cur_style>style=\".*)\">.*</th>` "$cur_style" . ) }}
  {{ $inner_html := replaceRE `.*@@w=(?P<width>.*)@@(?P<value>.*)` "$value" (. | plainify) }}
  {{ $width_value := replaceRE `.*@@w=(?P<width>.*)@@.*` "$width" . }}
  {{ if not (in $width_value "<th>") }}  {{/* å¦‚æœæ²’æ‰¾åˆ°ä»–æœƒå›å‚³æ‰¾å°‹ç‰©ä»¶çš„æœ¬èº«(å®ƒå«æœ‰th) è‡³æ–¼å¦‚æœæ‰¾åˆ°äº†è©±å°±åªæœƒæœ‰æ•¸å€¼5emä¹‹é¡çš„ */}}
    {{ if in $org_style `style="` }}
      {{ $html_table = replace $html_table . (printf `<th %s;width:%s">%s</th>` $org_style $width_value $inner_html ) }}
    {{ else }}
      {{ $html_table = replace $html_table . (printf `<th style="width:%s;">%s</th>` $width_value $inner_html) }}
    {{ end }}
  {{ end }}
{{ end }}

{{ $html_table := $html_table | safeHTML }}

{{ return (cond $scrollable (printf `<div style="max-height:30rem; overflow:auto;">%s</div>` $html_table | safeHTML) $html_table ) }}
